<ResourceDictionary
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:System="clr-namespace:System;assembly=mscorlib"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions"
    xmlns:media="clr-namespace:System.Windows.Media;assembly=PresentationCore"
    xmlns:customControls="clr-namespace:Theme.CustomControl"
    xmlns:converters="clr-namespace:Theme.Converters"
    xmlns:ed="http://schemas.microsoft.com/expression/2010/drawing">
    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="ThemeCommonDefine.xaml" />
    </ResourceDictionary.MergedDictionaries>
    <converters:ProgressValueToPercentage x:Key="ProgressValueToPercentage" />

    <ContentControl x:Key="DefaultPART_Percentage">
        <TextBlock x:Name="tbPercentage" VerticalAlignment="Center" HorizontalAlignment="Center">
            <TextBlock.Text>
                <MultiBinding Converter="{StaticResource ResourceKey=ProgressValueToPercentage}">
                    <Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=customControls:CircularProgressBar}" Path="Maximum"/>
                    <Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=customControls:CircularProgressBar}" Path="Value"/>
                    <Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=customControls:CircularProgressBar}" Path="Minimum"/>
                </MultiBinding>
            </TextBlock.Text>
        </TextBlock>
    </ContentControl>

    <Style TargetType="{x:Type customControls:CircularProgressBar}">
        <Setter Property="Content" Value="{StaticResource DefaultPART_Percentage}" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type customControls:CircularProgressBar}">
                        <Grid>
                            <Ellipse Stroke="{TemplateBinding Background}" StrokeThickness="{TemplateBinding ArcWidth}" Height="{TemplateBinding Width}" Width="{TemplateBinding Width}" />
                            <ed:Arc x:Name="PART_Track" Height="{TemplateBinding Width}" Width="{TemplateBinding Width}" StartAngle="0" EndAngle="0" 
                                Fill="{TemplateBinding Foreground}" Panel.ZIndex="1" ArcThickness="{TemplateBinding ArcWidth}" Stretch="None" StrokeEndLineCap="Round" StrokeStartLineCap="Round"
                                ArcThicknessUnit="Pixel" RenderTransformOrigin="0.5, 0.5">
                                <ed:Arc.RenderTransform>
                                    <TransformGroup>
                                        <RotateTransform />
                                    </TransformGroup>
                                </ed:Arc.RenderTransform>
                            </ed:Arc>
                        <ed:Arc x:Name="PART_Track_Repeat" Width="{TemplateBinding Width}" Height="{TemplateBinding Width}"
                                     Fill="{TemplateBinding Foreground}" Panel.ZIndex="1" StartAngle="0" EndAngle="90" ArcThickness="{TemplateBinding ArcWidth}" Visibility="Collapsed"
                                     Stretch="None" StrokeEndLineCap="Round" StrokeStartLineCap="Round" 
                                     ArcThicknessUnit="Pixel" RenderTransformOrigin="0.5,0.5">
                            <ed:Arc.RenderTransform>
                                <TransformGroup>
                                    <RotateTransform/>
                                </TransformGroup>
                            </ed:Arc.RenderTransform>
                        </ed:Arc>
                        <ContentPresenter x:Name="PART_Percentage" Content="{TemplateBinding Content}" />
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsIndeterminate" Value="True">
                            <Setter Property="Visibility" TargetName="PART_Track" Value="Hidden"/>
                            <Setter Property="Visibility" TargetName="PART_Track_Repeat" Value="Visible"/>
                            <Setter Property="Visibility" TargetName="PART_Percentage" Value="Hidden"/>
                            <Trigger.EnterActions>
                                <BeginStoryboard>
                                    <Storyboard RepeatBehavior="Forever">
                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="PART_Track_Repeat" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(RotateTransform.Angle)">
                                            <EasingDoubleKeyFrame KeyTime="00:00:00" Value="0"/>
                                            <EasingDoubleKeyFrame KeyTime="00:00:01" Value="360"/>
                                        </DoubleAnimationUsingKeyFrames>
                                    </Storyboard>
                                </BeginStoryboard>
                            </Trigger.EnterActions>
                        </Trigger>
                        <MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="IsIndeterminate" Value="false"/>
                                <Condition Property="Value" Value="0"/>
                            </MultiTrigger.Conditions>
                            <Setter Property="Visibility" Value="Hidden" TargetName="PART_Track"/>
                        </MultiTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>